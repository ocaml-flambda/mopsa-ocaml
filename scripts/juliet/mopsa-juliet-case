#!/bin/bash

MOPSADIR="$(cd "$(dirname "$0")" && pwd -P)/../.."

directory=$(dirname $1)
casename=$(basename $1 .c)

files=$(find ${directory} -name "${casename}*.c" | sort -nr)
good="${casename}_good"
bad="${casename}_bad"

MOPSA="${MOPSADIR}/scripts/mopsa-c -I ${MOPSADIR}/analyzer/stubs/c -I ${MOPSADIR}/analyzer/stubs/c/juliet ${MOPSADIR}/analyzer/stubs/c/mopsa_libc.c ${MOPSADIR}/analyzer/stubs/c/juliet/std_testcase.c ${MOPSADIR}/analyzer/stubs/c/juliet/std_testcase_io.c"

echo "Analyzing ${casename}"
echo "Good case: ${good}"
echo "${MOPSA} -c-entry ${good} ${files}"
${MOPSA} -c-entry ${good} ${files}
echo "Bad case"
${MOPSA} -c-entry "${bad}" ${files}
echo
echo "===================================================="
echo
